{% load static %}

<!-- Modern Sidebar -->
<div id="sidebar" class="fixed inset-y-0 left-0 z-50 w-72 bg-gradient-to-br from-gradient-start to-gradient-end transform -translate-x-full transition-all duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 shadow-2xl">
    <!-- Header Section -->
    <div class="relative h-20 bg-black bg-opacity-20 backdrop-blur-sm border-b border-white border-opacity-10">
        <div class="flex items-center justify-center h-full px-6">
            <a href="{% url 'home' %}" class="flex items-center text-white group transition-all duration-300 hover:scale-105">
                <div class="relative">
                    <img src="{% static 'images/logo.png' %}" alt="ITICO" class="w-10 h-10 mr-3 object-contain rounded-lg bg-white bg-opacity-10 p-1 group-hover:bg-opacity-20 transition-all duration-300">
                    <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                </div>
                <div class="flex flex-col">
                    <span class="text-xl font-bold tracking-wide">ITICO</span>
                    <span class="text-xs text-blue-200 font-medium">Portal de Contrapartes</span>
                </div>
            </a>
        </div>
    </div>
    
    <!-- Navigation Section -->
    <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
        {% if user.is_authenticated %}
            <div class="mb-6">
                <p class="px-4 text-xs font-semibold text-blue-200 uppercase tracking-wider mb-3">Men√∫ Principal</p>
                
                <!-- Cumplimiento Section -->
                <div class="mb-4">
                    <button onclick="toggleCumplimiento()" class="w-full nav-link group flex items-center px-4 py-3 text-white rounded-xl hover:bg-white hover:bg-opacity-10 transition-all duration-300 relative overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-r from-indigo-400 to-purple-600 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                        <div class="relative flex items-center w-full">
                            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-white bg-opacity-10 group-hover:bg-opacity-20 transition-all duration-300 mr-3">
                                <i class="fas fa-shield-alt text-lg group-hover:scale-110 transition-transform duration-300"></i>
                            </div>
                            <span class="font-medium group-hover:translate-x-1 transition-transform duration-300">Cumplimiento</span>
                            <div class="ml-auto transition-transform duration-300" id="cumplimiento-arrow">
                                <i class="fas fa-chevron-down text-sm"></i>
                            </div>
                        </div>
                    </button>
                    
                    <!-- Collapsible Cumplimiento Menu -->
                    <div id="cumplimiento-menu" class="mt-2 ml-4 space-y-1 transition-all duration-300 max-h-0 overflow-hidden">
                        <a href="{% url 'dashboard:index' %}" class="nav-link group flex items-center px-4 py-2 text-white rounded-lg hover:bg-white hover:bg-opacity-5 transition-all duration-300">
                            <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-white bg-opacity-5 group-hover:bg-opacity-10 transition-all duration-300 mr-3">
                                <i class="fas fa-chart-line text-sm group-hover:scale-110 transition-transform duration-300"></i>
                            </div>
                            <span class="font-medium text-sm group-hover:translate-x-1 transition-transform duration-300">Dashboard</span>
                        </a>
                        
                        <a href="{% url 'contrapartes:lista' %}" class="nav-link group flex items-center px-4 py-2 text-white rounded-lg hover:bg-white hover:bg-opacity-5 transition-all duration-300">
                            <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-white bg-opacity-5 group-hover:bg-opacity-10 transition-all duration-300 mr-3">
                                <i class="fas fa-building text-sm group-hover:scale-110 transition-transform duration-300"></i>
                            </div>
                            <span class="font-medium text-sm group-hover:translate-x-1 transition-transform duration-300">Contrapartes</span>
                        </a>
                        
                        <a href="{% url 'debida_diligencia:lista' %}" class="nav-link group flex items-center px-4 py-2 text-white rounded-lg hover:bg-white hover:bg-opacity-5 transition-all duration-300">
                            <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-white bg-opacity-5 group-hover:bg-opacity-10 transition-all duration-300 mr-3">
                                <i class="fas fa-search text-sm group-hover:scale-110 transition-transform duration-300"></i>
                            </div>
                            <span class="font-medium text-sm group-hover:translate-x-1 transition-transform duration-300">Debida Diligencia</span>
                        </a>
                        
                        <a href="{% url 'debida_diligencia:calendario' %}" class="nav-link group flex items-center px-4 py-2 text-white rounded-lg hover:bg-white hover:bg-opacity-5 transition-all duration-300">
                            <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-white bg-opacity-5 group-hover:bg-opacity-10 transition-all duration-300 mr-3">
                                <i class="fas fa-calendar-alt text-sm group-hover:scale-110 transition-transform duration-300"></i>
                            </div>
                            <span class="font-medium text-sm group-hover:translate-x-1 transition-transform duration-300">Calendario</span>
                        </a>
                    </div>
                </div>
                
                <!-- Mantenimiento Section -->
                <div class="mb-4">
                    <button onclick="toggleMantenimiento()" class="w-full nav-link group flex items-center px-4 py-3 text-white rounded-xl hover:bg-white hover:bg-opacity-10 transition-all duration-300 relative overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-r from-green-400 to-teal-600 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                        <div class="relative flex items-center w-full">
                            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-white bg-opacity-10 group-hover:bg-opacity-20 transition-all duration-300 mr-3">
                                <i class="fas fa-cogs text-lg group-hover:scale-110 transition-transform duration-300"></i>
                            </div>
                            <span class="font-medium group-hover:translate-x-1 transition-transform duration-300">Mantenimiento</span>
                            <div class="ml-auto transition-transform duration-300" id="mantenimiento-arrow">
                                <i class="fas fa-chevron-down text-sm"></i>
                            </div>
                        </div>
                    </button>
                    
                    <!-- Collapsible Mantenimiento Menu -->
                    <div id="mantenimiento-menu" class="mt-2 ml-4 space-y-1 transition-all duration-300 max-h-0 overflow-hidden">
                        <a href="{% url 'contrapartes:tipo_lista' %}" class="nav-link group flex items-center px-4 py-2 text-white rounded-lg hover:bg-white hover:bg-opacity-5 transition-all duration-300">
                            <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-white bg-opacity-5 group-hover:bg-opacity-10 transition-all duration-300 mr-3">
                                <i class="fas fa-tags text-sm group-hover:scale-110 transition-transform duration-300"></i>
                            </div>
                            <span class="font-medium text-sm group-hover:translate-x-1 transition-transform duration-300">Tipos de Contraparte</span>
                        </a>
                        
                        <a href="{% url 'contrapartes:estado_lista' %}" class="nav-link group flex items-center px-4 py-2 text-white rounded-lg hover:bg-white hover:bg-opacity-5 transition-all duration-300">
                            <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-white bg-opacity-5 group-hover:bg-opacity-10 transition-all duration-300 mr-3">
                                <i class="fas fa-toggle-on text-sm group-hover:scale-110 transition-transform duration-300"></i>
                            </div>
                            <span class="font-medium text-sm group-hover:translate-x-1 transition-transform duration-300">Estados de Contraparte</span>
                        </a>
                        
                        <a href="{% url 'contrapartes:tipo_documento_lista' %}" class="nav-link group flex items-center px-4 py-2 text-white rounded-lg hover:bg-white hover:bg-opacity-5 transition-all duration-300">
                            <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-white bg-opacity-5 group-hover:bg-opacity-10 transition-all duration-300 mr-3">
                                <i class="fas fa-file-alt text-sm group-hover:scale-110 transition-transform duration-300"></i>
                            </div>
                            <span class="font-medium text-sm group-hover:translate-x-1 transition-transform duration-300">Tipos de Documento</span>
                        </a>
                        
                        <a href="{% url 'contrapartes:calificador_lista' %}" class="nav-link group flex items-center px-4 py-2 text-white rounded-lg hover:bg-white hover:bg-opacity-5 transition-all duration-300">
                            <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-white bg-opacity-5 group-hover:bg-opacity-10 transition-all duration-300 mr-3">
                                <i class="fas fa-star text-sm group-hover:scale-110 transition-transform duration-300"></i>
                            </div>
                            <span class="font-medium text-sm group-hover:translate-x-1 transition-transform duration-300">Calificadores</span>
                        </a>
                        
                        <a href="{% url 'contrapartes:outlook_lista' %}" class="nav-link group flex items-center px-4 py-2 text-white rounded-lg hover:bg-white hover:bg-opacity-5 transition-all duration-300">
                            <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-white bg-opacity-5 group-hover:bg-opacity-10 transition-all duration-300 mr-3">
                                <i class="fas fa-chart-line text-sm group-hover:scale-110 transition-transform duration-300"></i>
                            </div>
                            <span class="font-medium text-sm group-hover:translate-x-1 transition-transform duration-300">Outlooks</span>
                        </a>
                    </div>
                </div>
                
                <a href="{% url 'notificaciones:lista' %}" class="nav-link group flex items-center px-4 py-3 text-white rounded-xl hover:bg-white hover:bg-opacity-10 transition-all duration-300 relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-r from-yellow-400 to-orange-500 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    <div class="relative flex items-center w-full">
                        <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-white bg-opacity-10 group-hover:bg-opacity-20 transition-all duration-300 mr-3">
                            <i class="fas fa-bell text-lg group-hover:scale-110 transition-transform duration-300"></i>
                        </div>
                        <span class="font-medium group-hover:translate-x-1 transition-transform duration-300">Notificaciones</span>
                        <div class="ml-auto flex items-center space-x-2">
                            <span id="notification-count" class="bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-semibold shadow-lg animate-bounce-gentle">0</span>
                            <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                <i class="fas fa-arrow-right text-sm"></i>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        {% endif %}
    </nav>
    
    <!-- User Section -->
    {% include 'partials/user_menu.html' %}
</div>

<!-- JavaScript for Collapsible Menu -->
<script>
function toggleCumplimiento() {
    const menu = document.getElementById('cumplimiento-menu');
    const arrow = document.getElementById('cumplimiento-arrow');
    
    if (menu.style.maxHeight === '0px' || menu.style.maxHeight === '') {
        // Expand
        menu.style.maxHeight = menu.scrollHeight + 'px';
        arrow.innerHTML = '<i class="fas fa-chevron-up text-sm"></i>';
        
        // Store state in localStorage
        localStorage.setItem('cumplimiento-expanded', 'true');
    } else {
        // Collapse
        menu.style.maxHeight = '0px';
        arrow.innerHTML = '<i class="fas fa-chevron-down text-sm"></i>';
        
        // Store state in localStorage
        localStorage.setItem('cumplimiento-expanded', 'false');
    }
}

function toggleMantenimiento() {
    const menu = document.getElementById('mantenimiento-menu');
    const arrow = document.getElementById('mantenimiento-arrow');
    
    if (menu.style.maxHeight === '0px' || menu.style.maxHeight === '') {
        // Expand
        menu.style.maxHeight = menu.scrollHeight + 'px';
        arrow.innerHTML = '<i class="fas fa-chevron-up text-sm"></i>';
        
        // Store state in localStorage
        localStorage.setItem('mantenimiento-expanded', 'true');
    } else {
        // Collapse
        menu.style.maxHeight = '0px';
        arrow.innerHTML = '<i class="fas fa-chevron-down text-sm"></i>';
        
        // Store state in localStorage
        localStorage.setItem('mantenimiento-expanded', 'false');
    }
}

// Initialize collapsible state from localStorage on page load
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Cumplimiento menu
    const cumplimientoMenu = document.getElementById('cumplimiento-menu');
    const cumplimientoArrow = document.getElementById('cumplimiento-arrow');
    const isCumplimientoExpanded = localStorage.getItem('cumplimiento-expanded');
    
    // Default to expanded if no preference is stored
    if (isCumplimientoExpanded === null || isCumplimientoExpanded === 'true') {
        cumplimientoMenu.style.maxHeight = cumplimientoMenu.scrollHeight + 'px';
        cumplimientoArrow.innerHTML = '<i class="fas fa-chevron-up text-sm"></i>';
    } else {
        cumplimientoMenu.style.maxHeight = '0px';
        cumplimientoArrow.innerHTML = '<i class="fas fa-chevron-down text-sm"></i>';
    }
    
    // Initialize Mantenimiento menu
    const mantenimientoMenu = document.getElementById('mantenimiento-menu');
    const mantenimientoArrow = document.getElementById('mantenimiento-arrow');
    const isMantenimientoExpanded = localStorage.getItem('mantenimiento-expanded');
    
    // Default to collapsed for mantenimiento
    if (isMantenimientoExpanded === 'true') {
        mantenimientoMenu.style.maxHeight = mantenimientoMenu.scrollHeight + 'px';
        mantenimientoArrow.innerHTML = '<i class="fas fa-chevron-up text-sm"></i>';
    } else {
        mantenimientoMenu.style.maxHeight = '0px';
        mantenimientoArrow.innerHTML = '<i class="fas fa-chevron-down text-sm"></i>';
    }
});
</script>
